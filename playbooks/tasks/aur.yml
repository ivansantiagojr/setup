---
- name: AUR packages
  hosts: localhost

  tasks:
    - name: Create the `aur_builder` user
      become: yes
      ansible.builtin.user:
        name: aur_builder
        create_home: yes
        group: wheel

    - name: Allow the `aur_builder` user to run `sudo pacman` without a password
      become: yes
      ansible.builtin.lineinfile:
        path: /etc/sudoers.d/11-install-aur_builder
        line: 'aur_builder ALL=(ALL) NOPASSWD: /usr/bin/pacman'
        create: yes
        mode: 0644
        validate: 'visudo -cf %s'

    - name: Zen Browser
      kewlfft.aur.aur:
        use: paru
        name: zen-browser-bin
        state: present
      become: yes
      become_user: aur_builder

    - name: Defold game engine
      kewlfft.aur.aur:
        use: paru
        name: defold-bin
        state: present
      become: yes
      become_user: aur_builder

    - name: 1password gpg
      shell: |
        curl -sS https://downloads.1password.com/linux/keys/1password.asc | gpg --import
      become: yes
      become_user: aur_builder

    - name: 1password git clone
      git:
        repo: https://aur.archlinux.org/1password.git
        dest: ~/1password
        force: true
      become: yes
      become_user: aur_builder

    - name: Install 1password
      shell: |
        cd ~/1password
        makepkg -si --noconfirm
      become: yes
      become_user: aur_builder
